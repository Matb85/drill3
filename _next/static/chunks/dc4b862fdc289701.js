(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35751,e=>{"use strict";class t{mappers;constructor(e){this.mappers=e}load(e,t=()=>void 0){let r=JSON.parse(e),n={};for(let e of Object.keys(this.mappers))try{let s=this.mappers[e](r[e],e,t);if(void 0===s)continue;if(null===s||"object"!=typeof s||Array.isArray(s))n[e]=s;else for(let[e,t]of Object.entries(s)){if(e in n)throw Error(`Member ${e} already exists`);n[e]=t}}catch(r){t(`Mapper ${e} threw an exception`)}return{object:n,unknown:Object.keys(r).filter(e=>!(e in this.mappers))}}}let r=e=>!(!e||["false","no","disabled","disable","0"].includes("string"==typeof e?e.toLowerCase():"")),n=(e,t,r=e=>e)=>(n,s,i)=>{let o={[e]:{}};if(void 0===n)return o;if("object"!=typeof n||null===n||Array.isArray(n))return i(`Invalid ${e} object (type: ${Array.isArray(n)?"array":typeof n})`),o;let a={};for(let[s,o]of Object.entries(n))/^[A-Z\d\-+_]+$/i.exec(s)?t(o,s,i)&&(a[s]=r(o)):i(`Invalid ${e} key '${s}'`);return{[e]:a}},s={format:e=>e?"legacy"===e||"2"===e||"2.1"===e?e:"unknown":"legacy",markdown:e=>{let t=r(e);return{markdownReady:t,markdown:t}},mathjax:e=>{let t=r(e);return{mathjaxReady:t,mathjax:t}},grading:(e,t,r)=>{if("perQuestion"===e||"perAnswer"===e)return{gradingMethod:e};let n="string"==typeof e?/^custom: *(.+)$/.exec(e):null;if(n)try{return Function("id",n[1]),{gradingMethod:"custom",customGrader:n[1]}}catch(e){return r("Custom grader caused an error while being tested"),{gradingMethod:"perAnswer"}}return e&&r("Grader spec isn't recognized as a valid expression"),{gradingMethod:"perAnswer"}},gradingRadical:e=>r(e)?"1":"0",gradingPPQ:e=>Number.parseInt(String(e),10)||1,timeLimit:e=>{let t=Number.parseInt(String(e),10);return Number.isFinite(t)?{timeLimitEnabled:!0,timeLimitSecs:t/5*5}:{timeLimitEnabled:!1,timeLimitSecs:60}},repeatIncorrect:r,displayAsRadio:r,explain:(e,t,r)=>{let n="string"==typeof e?e.toLowerCase():"";return"summary"===n||"optional"===n||"always"===n?{explain:n,showExplanations:"always"===n}:(e&&r(`Unsupported explanations mode '${e}', falling back to 'optional'`),{explain:"optional",showExplanations:!1})},explanations:n("explanations",(e,t,r)=>"string"!=typeof e?(r(`Value of explanation '${t}' is not a string`),!1):0!==e.trim().length||(r(`Value of explanation '${t}' is empty`),!1),e=>e),relatedLinks:n("relatedLinks",(e,t,r)=>{if(Array.isArray(e)){let n=e.every(e=>"string"==typeof e);return n||r(`Related link '${t}' contains non-string value`),n}return"string"==typeof e||(r(`Value of related link '${t}' is not an array or string`),!1)},e=>Array.isArray(e)?e:[e])};class i{process(e,r=()=>void 0){try{let n=new t(s).load(e,r);for(let e of n.unknown)r(`Unknown option ${e}`);return n.object}catch(i){let e=/[a-z\d_-]*Error/i.exec(String(i)),n=e?.[0];return"SyntaxError"===n?r("Syntax error in <options> block - parsing failed"):n?r(`Parsing <options> block failed - ${n}`):r("Parsing <options> block failed"),new t(s).load("{}",r).object}}}let o=/<options>\s*(\{(?:.|\n|\r)*})\s*/i;class a{processor=new i;loadOptions(e){return(t,r)=>{if(!Array.isArray(t))throw Error("Expected an array as input");if("object"!=typeof e||null===e)throw Error("Expected an object as target");if(0===t.length)return t;let n=t[t.length-1],s=o.exec(n);if(!s)return Object.assign(e,this.processor.process("{}")),t;let i=s[1];return Object.assign(e,this.processor.process(i,r)),t.slice(0,t.length-1)}}assignQuestionExtras(e){let t=e.explanations||{},r=e.relatedLinks||{};return(n,s)=>{if(!Array.isArray(n))throw Error("Expected an array of questions");if("object"!=typeof t)throw Error("Expected a map of explanations");if("object"!=typeof r)throw Error("Expected a map of related links");if(0===n.length)return n;let i=Object.keys(t),o=[];for(let e of n)e.id in t&&(e.setExplanation(t[e.id]),o.push(e.id));i.length>o.length&&s(`${i.length-o.length} explanations couldn't be matched to questions`);let a=Object.keys(r),l=[];for(let e of n)e.id in r&&(e.setRelatedLinks(r[e.id]),l.push(e.id));return a.length>l.length&&s(`${a.length-l.length} related links couldn't be matched to questions`),e.explanationsAvailable=o.length>0,n}}}let l=(e,t)=>(Array.isArray(e)?e.join("\n\n"):e).split(/(?:\r?\n){2,}/);function d(e){let t=/^\s*(>+)?\s*([A-Z])\)\s*([\s\S]+)$/i.exec(e);return t?{correct:!!t[1],letter:t[2],content:t[3]}:null}let h=(e,t)=>e.trim().length>0;class p{body;id;answers;explanation;relatedLinks;constructor(e,t){this.body=e,this.id=t,this.answers=[]}addAnswer(e,t,r){let n=r||`A${this.answers.length+1}`;if(this.answers.find(e=>e.id===n))throw Error(`Duplicate answer with ID ${n}) in question: "${this.body}". Answer IDs must be unique.`);this.answers.push({id:n,body:e.trim(),correct:t})}totalCorrect(){return this.answers.filter(e=>e.correct).length}setExplanation(e){this.explanation=e}setRelatedLinks(e){this.relatedLinks=e}}class u{identifier=null;bodyLines=[];question=null;answer={lines:[],correct:!1,identifier:null};setIdentifier(e){if(this.identifier)throw Error("Identifier already set");return this.identifier=e,this}appendToBody(e){if(this.question)throw Error("Answers already appended");return this.bodyLines.push(e),this}buildQuestion(){let e=this.identifier||`Q${Math.random().toString(36).slice(2,8)}`;this.question=new p(this.bodyLines.join("\n\n"),e)}pushAnswer(){if(!this.question)return;let e=this.answer.lines.join("\n");try{this.question.addAnswer(e,this.answer.correct,this.answer.identifier||void 0)}catch(e){throw this.answer.lines=[],e}this.answer.lines=[]}addAnswer(e,t,r){return this.question?this.answer.lines.length&&this.pushAnswer():this.buildQuestion(),this.answer.lines.push(e.trim()),this.answer.correct=t,this.answer.identifier=r,this}addAnswers(e){for(let t of(this.question?this.answer.lines.length&&this.pushAnswer():this.buildQuestion(),e))this.question?.addAnswer(t.body,t.correct,t.id);return this}appendAnswerLine(e){if(!this.answer.lines.length)throw Error("Answer not created yet");return this.answer.lines.push(e.trim()),this}build(){if(this.question?this.answer.lines.length&&this.pushAnswer():this.buildQuestion(),!this.question)throw Error("Failed to build question");return this.question}}class c{merge(e,t){let r=new u().setIdentifier(e.id);return e.body.trim().length>0&&r.appendToBody(e.body),t.body.trim().length>0&&r.appendToBody(t.body),r.addAnswers(e.answers).addAnswers(t.answers).build()}}let g=(e,t=40)=>{let r=e.body.trim();return r.length>t?`${r.substring(0,t)}...`:0===r.length?"[no body]":r};class f{parseQuestion(e,t){var r;let n,s=e.split(/(?:\r?\n)/),i=new u,o=[...s],a=(r=o[0]??"",(n=/^\[#([A-Z\d\-+_]+)]\s*([\s\S]*)$/i.exec(r))?{identifier:n[1],content:n[2]}:null);a&&(o=o.slice(1),i.appendToBody(a.content),i.setIdentifier(a.identifier));let l=!1;try{for(let e of o)if(l){let t=d(e);t?i.addAnswer(t.content,t.correct,t.letter):i.appendAnswerLine(e)}else{let t=d(e);t?(l=!0,i.addAnswer(t.content,t.correct,t.letter)):i.appendToBody(e)}}catch(e){t(`Error parsing question: ${e.message}`)}return i.build()}mergeBrokenQuestions(e,t=()=>void 0){let r=e.map(e=>0===e.body.trim().length).slice(1);for(let t=0;t<r.length;t+=1)0===e[t].answers.length&&(r[t]=!0);r.push(!1);let n=[],s=[...e],i=new c;for(;s.length>1;){let e=s.shift(),o=r.shift(),a=1;for(;o;){let t=s.shift(),n=r.shift();if(!t||void 0===n)break;e=i.merge(e,t),o=n,a+=1}if(n.push(e),a>1){e.merged=a;let r=g(e);t(`Merged ${a} questions: '${r}' (${e.answers.length} answers total)`)}}return n.concat(s)}removeInvalidQuestions(e,t=()=>void 0){let r=[];for(let n of e){let e="";n.body.trim().length?n.answers.length<2?(e=`Skipped question because it has less than 2 answers: '${g(n)}'`,n.merged&&(e+=` (merged from ${n.merged} questions)`)):!n.totalCorrect()&&(e=`Skipped question because it has no correct answers: '${g(n)}'`,n.merged&&(e+=` (merged from ${n.merged} questions)`)):e=`Skipped question because it has no body (${n.answers.length} answers)`,e?t(e):r.push(n)}return r}matchNonEmptyStrings(e){return e.trim().length>0}}class w{log;data;constructor(e,t=[]){this.data=e,this.log=t}logAppender=e=>{this.log.push(e)};apply(e){return new w(e(this.data,this.logAppender),this.log)}map(e){if(!Array.isArray(this.data))throw Error("Pipeline content is not an array");return new w(this.data.map(t=>e(t,this.logAppender)),this.log)}filter(e){if(!Array.isArray(this.data))throw Error("Pipeline content is not an array");return new w(this.data.filter(t=>e(t,this.logAppender)),this.log)}get(){return this.data}getLog(){return[...this.log]}}class y{optionsUtils=new a;parsingUtils=new f;parse(e){let t={},r=new w(e).apply(l).filter(h).apply(this.optionsUtils.loadOptions(t)).map((e,t)=>this.parsingUtils.parseQuestion(e,t)).apply((e,t)=>this.parsingUtils.mergeBrokenQuestions(e,t)).apply((e,t)=>this.parsingUtils.removeInvalidQuestions(e,t)).apply(this.optionsUtils.assignQuestionExtras(t));return{questions:r.get(),options:t,log:r.getLog()}}}let m=new y;function b(e){let t=e.body.trim()||"Untitled question",r=e.answers.map(t=>({id:`${e.id}_${t.id}`,text:t.body,correct:t.correct,explanation:e.explanation}));return{id:e.id,prompt:t,options:r}}function A(e){let{questions:t,options:r,log:n}=m.parse(e);return console.log("Parsed questions:",t),{questions:t.map(b),options:r,log:n}}e.s(["parseQuestionsFromText",()=>A],35751)}]);